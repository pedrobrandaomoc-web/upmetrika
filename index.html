document.addEventListener('DOMContentLoaded', function () {
    
    // --- Lógica do Menu Mobile ---
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    
    if (mobileMenuButton && mobileMenu) {
        mobileMenuButton.addEventListener('click', () => {
            const isExpanded = mobileMenuButton.getAttribute('aria-expanded') === 'true';
            mobileMenu.classList.toggle('hidden');
            mobileMenuButton.setAttribute('aria-expanded', !isExpanded);
        });

        document.querySelectorAll('#mobile-menu a').forEach(link => {
            link.addEventListener('click', () => {
                mobileMenu.classList.add('hidden');
                mobileMenuButton.setAttribute('aria-expanded', 'false');
            });
        });
    }

    // --- Lógica do Acordeão (FAQ) ---
    const accordionItems = document.querySelectorAll('.accordion-item');
    accordionItems.forEach((item) => {
        const header = item.querySelector('.accordion-header');
        const content = item.querySelector('.accordion-content');
        const icon = header.querySelector('span:last-child');

        header.addEventListener('click', () => {
            const isOpen = content.style.maxHeight && content.style.maxHeight !== '0px';
            
            accordionItems.forEach(otherItem => {
                if (otherItem !== item) {
                    otherItem.querySelector('.accordion-content').style.maxHeight = '0px';
                    const otherIcon = otherItem.querySelector('.accordion-header span:last-child');
                    otherIcon.classList.add('rotate-45');
                    otherIcon.textContent = '+';
                }
            });

            if (isOpen) {
                content.style.maxHeight = '0px';
                icon.classList.add('rotate-45');
                icon.textContent = '+';
            } else {
                content.style.maxHeight = content.scrollHeight + 'px';
                icon.classList.remove('rotate-45');
                icon.textContent = '-';
            }
        });
    });
    
    // --- Lógica de Animação ao Rolar (Fade-in) ---
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('visible');
            }
        });
    }, {
        threshold: 0.1
    });

    document.querySelectorAll('.fade-in').forEach((el) => {
        observer.observe(el);
    });
    
    // --- Lógica de Rolagem Suave (Smooth Scroll) ---
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            const targetId = this.getAttribute('href');
            if (targetId && targetId.length > 1 && targetId.startsWith('#')) {
                e.preventDefault();
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    const navbarHeight = document.getElementById('navbar').offsetHeight;
                    const targetPosition = targetElement.getBoundingClientRect().top + window.pageYOffset - navbarHeight;
                    window.scrollTo({
                        top: targetPosition,
                        behavior: 'smooth'
                    });
                }
            }
        });
    });

    // --- LÓGICA DA CALCULADORA (CORRIGIDA PARA COMPATIBILIDADE) ---

    const calculateBtn = document.getElementById('calculate-btn');
    if (calculateBtn) {
        calculateBtn.addEventListener('click', function() {
            // Passo 1: Selecionar os elementos DENTRO do evento de clique.
            // Isso garante que estamos pegando os valores mais atuais.
            const employeesInput = document.getElementById('employees');
            const tasksPerDayInput = document.getElementById('tasksPerDay');
            const timePerTaskInput = document.getElementById('timePerTask');
            const hourlyCostInput = document.getElementById('hourlyCost');
            
            // Passo 2: Obter os valores e garantir compatibilidade.
            // A função getValue trata o texto para que funcione com ponto ou vírgula.
            const getValue = (inputElement) => {
                if (!inputElement) return NaN;
                // Substitui a vírgula por ponto para garantir que o parseFloat funcione em todos os navegadores.
                const valueWithPeriod = inputElement.value.replace(',', '.');
                return parseFloat(valueWithPeriod);
            };

            const employees = getValue(employeesInput);
            const tasksPerDay = getValue(tasksPerDayInput);
            const timePerTask = getValue(timePerTaskInput);
            const hourlyCost = getValue(hourlyCostInput);

            // Passo 3: Validar os dados.
            const resultsCard = document.getElementById('results-card');
            const resultsPlaceholder = document.getElementById('results-placeholder');
            const resultsContent = document.getElementById('results-content');

            if (isNaN(employees) || isNaN(tasksPerDay) || isNaN(timePerTask) || isNaN(hourlyCost) || employees <= 0 || tasksPerDay <= 0 || timePerTask <= 0 || hourlyCost <= 0) {
                resultsPlaceholder.querySelector('p').textContent = 'Por favor, preencha todos os campos com valores válidos.';
                resultsPlaceholder.classList.remove('hidden');
                resultsContent.classList.add('hidden');
                return;
            }

            // Passo 4: Realizar os cálculos.
            const dailyMinutes = employees * tasksPerDay * timePerTask;
            const monthlyHours = (dailyMinutes * 22) / 60; // 22 dias úteis por mês
            const automationEfficiency = 0.80;
            const hoursSaved = monthlyHours * automationEfficiency;
            const monthlySavings = hoursSaved * hourlyCost;
            const annualSavings = monthlySavings * 12;

            // Passo 5: Formatar e exibir os resultados na tela.
            document.getElementById('hours-saved').textContent = hoursSaved.toFixed(1).replace('.', ',');
            document.getElementById('monthly-savings').textContent = monthlySavings.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            document.getElementById('annual-savings').textContent = annualSavings.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

            // Passo 6: Atualizar a interface do card de resultados.
            resultsPlaceholder.classList.add('hidden');
            resultsContent.classList.remove('hidden');
            resultsCard.style.opacity = '1';
            resultsCard.style.transform = 'translateY(0)';
            resultsCard.classList.remove('border-dashed', 'opacity-50');
            resultsCard.classList.add('border-solid');
        });
    }
});

